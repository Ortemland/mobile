# Анализ проблемы связки устройств

## Обнаруженные проблемы:

### 1. **UUID каждый раз новый**
В `FirebaseSyncRepository.getCurrentDeviceId()` каждый раз генерируется новый UUID:
```kotlin
private fun getCurrentDeviceId(): String {
    return java.util.UUID.randomUUID().toString()
}
```
**Проблема**: На устройстве взрослого создается один deviceId при создании семьи, но при проверке статуса создается ДРУГОЙ deviceId, и они не совпадают!

### 2. **Ребенок сохраняет setLinked(true)**
Ребенок вызывает `linkPreferences.setLinked(true)`, но эта функция не используется для проверки статуса.

### 3. **Нет механизма хранения deviceId**
Устройство должно иметь ОДИНАКОВЫЙ deviceId все время, а не каждый раз новый.

### 4. **familyId сохраняется только локально**
Приложение не использует familyId для проверки статуса связки правильно.

### 5. **isActive устанавливается в true только при связке**
После связки оба устройства должны видеть isActive=true в Firebase, но проверить не могут, потому что deviceId меняется.

## Решение:

1. Использовать Settings.Secure.ANDROID_ID для постоянного deviceId
2. Сохранять deviceId локально
3. Правильно проверять isActive статус

